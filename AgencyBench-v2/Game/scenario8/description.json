{
  "subtask_count": 5,
  "subtask1": "Query:\nDesign a static Flappy Bird launch screen that renders a vertically oriented playfield, foreground pipes, and a `Start Flight` button. The playfield must be a 360×640px panel centered in the viewport, framed by a sky gradient. Automatically call `window.app.initializeStage()` on load so the scene is displayed without user interaction, and ensure `window.app.describeStage()` returns viewport coordinates for the stage, start button, and pipe gap markers.\nDeliverables:\n- `index.html` linked to `styles.css` and `app.js`, containing `#stage`, `#hud`, and `#start-btn` containers plus placeholder pipes annotated with data attributes such as `data-pipe=\"lower\"`.\n- `styles.css` defining the 360×640 playfield, background parallax layers, and centered layout. The `#stage` element must expose a `data-theme=\"day\"` attribute for scripted checks.\n- `app.js` exporting `window.app` with `initializeStage()` and `describeStage()` (the latter returns `{ stage: { width, height, x, y }, startButton: { x, y }, pipes: [...] }`).\nRubric:\n- Stage metrics: automation inspects `stage_layout.png` and `describeStage()`; both must agree on a 360±4px width, 640±4px height, and centering offsets within ±6px horizontally and vertically.\n- Button placement: `describeStage().startButton.y` must land between the middle of the playfield and 120px above it, and the button text must be exactly `Start Flight`.\n- DOM contract: render at least two `.pipe` elements (upper + lower) inside `#stage`, include `#hud`, and keep the `data-theme` attribute accessible from `document.querySelector('#stage').dataset.theme`.\n- API idempotency: calling `window.app.initializeStage()` twice leaves a single stage instance without duplicating DOM nodes while still returning a fresh description payload.",
  "subtask2": "Query:\nAdd basic flight controls so clicking the stage or pressing the space bar causes the bird to flap upward while gravity pulls it downward. Show live status text in `#status-bar` and animate the latest input via `#last-input-indicator`, a 24±4px glowing ring that hugs the bird sprite. Continue using the deliverables from subtask1.\nDeliverables:\n- Augment `index.html` with `#status-bar` directly underneath `#hud` and mount `#last-input-indicator` within the stage.\n- Update `app.js` so `window.app.debugState()` returns `{ ticks, altitude, velocity, status, history: [...] }` and expose `window.app.queueInputs(sequence)` for automation to preload flap commands (array of `{ tick, action }`).\nRubric:\n- Interaction loop: automation clicks `#start-btn`, then triggers two `Space` key presses while capturing `flight_drill.webm`. `debugState().history` must record the two flaps with timestamps increasing by ≥50ms, and `status` transitions through `Idle → Flying → Paused` when the automation stops sending inputs.\n- Input halo: after the second flap, `#last-input-indicator` must overlap the bird sprite and pulse for ≥600ms in the recording.\n- Status copy: `#status-bar` reads `Tap or press space` on load, switches to `Flying…` during motion, then returns to `Paused` after 400±80ms of inactivity.\n- Layout regression: the playfield dimensions and `.pipe` structure from subtask1 must remain untouched.",
  "subtask3": "Query:\nDetect collisions, log every tick, and add timeline controls so reviewers can rewind or replay runs. Introduce `#controls` beneath the status bar containing buttons `button[data-action=\"rewind\"]`, `button[data-action=\"resume\"]`, and `button[data-action=\"instant-replay\"]` in that order. Display a `#run-banner` above the stage announcing `Crashed!` or `Great flight!`.\nDeliverables:\n- Keep shipping the three core files and add `session.log` with comma-separated rows (`timestamp,event,payload`).\n- Extend `window.app` with `rewind()`, `resume()`, `startReplay()`, `getRunSummary()`, `exportLog()`, and `runScriptedCourse(frames)` where `frames` is an array of `{ tick, action, altitude }` items used to deterministically simulate a flight and crash.\nRubric:\n- Crash script: invoking `runScriptedCourse([{tick:0,action:\"flap\"},{tick:6},{tick:12,action:\"flap\"},{tick:18},{tick:26},{tick:34,action:\"crash\"}])` must end the run, disable manual clicks, and make `getRunSummary()` return `{ outcome: 'crashed', score: number }`. `#run-banner` shows `Crashed!` and `session.log` gains entries for each frame plus a terminal outcome line.\n- Toolbar behavior: the automation clicks rewind → resume → instant-replay; the board responds by moving the bird to earlier frames, resuming, then replaying while `scripted_replay.webm` shows pipes animating at ≥280ms per frame. During replay, manual flaps must remain disabled.\n- Logging: `exportLog()` strings must match the on-disk `session.log` byte-for-byte. Any replay or rewind markers must be recorded.\n- Continuity: status bar messaging, input halo, and layout expectations from subtasks 1–2 still apply.",
  "subtask4": "Query:\nAdd persistence so reviewers can save and restore flights. Below the controls introduce a drawer `#persistence` holding buttons `#save-flight`, `#load-flight`, and `#reset-flight` plus a read-only `<textarea id=\"state-json\">`. Saving should populate the textarea and `localStorage['flappy-state']`. Resetting wipes the stage but increments aggregate totals displayed inside `#scoreboard` using counters `.best-score`, `.attempts`, and `.crash-count`.\nDeliverables:\n- Keep existing files. Style the persistence drawer to match the HUD and keep it responsive.\n- Extend `window.app` with `serializeState()`, `applyState(payload)`, `resetFlight()`, `getScoreboard()` returning `{ best: number, attempts: number, crashes: number }`, and `injectRunResult(snapshot)` for automation to store a synthetic finished run prior to saving.\nRubric:\n- Save flow: after a short run, pressing `#save-flight` updates `#state-json` with JSON containing at least `altitude`, `score`, and `history`. The identical string must be stored in `localStorage['flappy-state']`, and `serializeState()` returns the same payload.\n- Restore flow: invoking `resetFlight()` clears the stage but keeps scoreboard totals. Calling `applyState()` with the textarea contents reconstructs the bird position, halo, and `debugState()` history exactly as before the reset.\n- Scoreboard: when `injectRunResult({ outcome: 'success', score: 12, distance: 90 })` followed by `resetFlight()` is executed, `getScoreboard()` increments `.attempts` by one, updates `.best-score` to at least 12, and leaves `.crash-count` unchanged. DOM labels must mirror the same figures.\n- Regression: session logging, replay controls, and layout tolerances from subtasks 1–3 remain satisfied.",
  "subtask5": "Query:\nCreate a diagnostics sidebar and scripted scenarios to stress-test persistence. Add `#toggle-diagnostics` to reveal `<aside id=\"diagnostics\">` aligned to the right edge. The panel must list live metrics (depth, elapsedMs, pipesCleared, etc.) in a table with headers `Metric` and `Value`, plus scenario playback controls. Load fixtures from `hard_cases.json` containing objects with `id`, `label`, `inputs`, `result`, and `notes`.\nDeliverables:\n- Continue shipping the core files and now include `hard_cases.json`. The sidebar must provide buttons to preview scenarios, show aggregate stats, and list textual summaries.\n- Extend `window.app` with `loadScenario(id)`, `playScenario(id, options)`, `getDiagnostics()`, `summarizeScenario(id)`, and `estimateHeap()`. `playScenario` returns a Promise that resolves after the animation completes and re-enables manual controls.\nRubric:\n- Scenario import: calling `loadScenario(0)` should paint the bird and pipes per the fixture, set `#run-banner` text based on `result`, and log each scripted tick. `summarizeScenario(0)` returns `{ id, totalInputs, longestGlide }` or richer metadata referencing the file.\n- Playback: invoking `playScenario(1, { intervalMs: 220 })` animates the inputs sequentially with ≥200ms spacing while blocking manual flaps. Once finished, manual controls and the persistence drawer must work again.\n- Diagnostics: when the sidebar is visible, `getDiagnostics()` must expose keys `depth`, `elapsedMs`, `pipesCleared`, and `topLines` (array). The diagnostics table stays 260±6px wide and offset 60±6px from the right edge in `diagnostics.png`.\n- Stability: five successive calls to `estimateHeap()` return non-decreasing integers ≤64000000. All persistence, replay, and layout expectations from subtasks 1–4 must continue to pass."
}
